# Setup

## Azure AD B2C

An Azure AD B2C tenant is an Azure resource so you need a Microsoft account and go through that onboarding process to get into the Azure portal. Once you have your account, you can create a B2C tenant through the portal GUI or through IaC like Terraform. To configure it you have to switch to the tenant in your Azure Portal and navigate to the B2C blade. The setup is very similar to a standard Azure tenant with users and application registrations, but there's a special section for you to configure user flows like sign in, sign up, profile edit and password reset. Applications then interact with these flows through OIDC or SAML. There are two ways to create user flows, through the GUI or by "coding" XML documents with a schema Microsoft created that gets executed by a custom engine they created. It's the Trust Policy Framework Engine. The GUI is nice because it's simple, but all of the clients I have worked for had use cases that required us to use the Trust Policy Framework Engine so I spent a lot of time learning the schema and how to craft these policy documents to meet the clients needs. The benefit of the policy documents is you have almost limitless customization. You can put up arbitrary forms during your flows to collect data, you can call REST APIs to trigger other actions like custom SMS or Email provider or validate data against an on-prem system, or you can write enhanced logs to your SIEM. When you use the custom policy framework, you have to do a couple more steps of additional setup like create two app registrations, and policy keys (secrets that the XML files could use like to call REST APIs) just to make the custom policy framework function. Once you did this once or twice it became second nature and you can script it, but it's a step you have to take for every tenant which after you see the onboarding step for other platforms (like Clerk), it's not a great exerience. Then you get started writing your custom policies in XML starting with either a Microsoft sample or from samples you have from other engagements.

## Clerk

Getting started with Clerk is super easy. Created my account through the Github integration and it took me straight into registering my first application. You have to provide minimal data for your app like the name, and what type of login options do you want, then it takes you straight to an integration guide based on the type of app you're integrating. I use Next so I just had to install the clerk npm package, add my environment file, add my middleware, add my components and then it was done. At least for Next, I loved that it walked you through the whole process in the dashboard and you didn't need any supporting documentation to get started. Setting up B2C the first time, I definitely needed the documentation pulled up on one screen and my azure portal on the other. Another thing that stood out is how easy it was to get the integration with Google as a social provider working in development. No need to create a google app registration and exchange OIDC information, client id and secret, etc. It just worked. In B2C you had to do all that for even a dev connection to work.